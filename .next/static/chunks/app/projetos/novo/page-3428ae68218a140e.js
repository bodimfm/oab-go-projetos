(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[394],{2790:function(e,s,a){Promise.resolve().then(a.bind(a,7371))},9376:function(e,s,a){"use strict";var o=a(5475);a.o(o,"useParams")&&a.d(s,{useParams:function(){return o.useParams}}),a.o(o,"usePathname")&&a.d(s,{usePathname:function(){return o.usePathname}}),a.o(o,"useRouter")&&a.d(s,{useRouter:function(){return o.useRouter}}),a.o(o,"useSearchParams")&&a.d(s,{useSearchParams:function(){return o.useSearchParams}})},7371:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return c}});var o=a(7437),r=a(2265),t=a(9376),i=a(7648),l=a(4933);function n(e){let{comissoes:s,onComissaoSelect:a,disabled:t,placeholder:i="Buscar comiss\xe3o..."}=e,[l,n]=(0,r.useState)(""),[c,d]=(0,r.useState)([]),[m,u]=(0,r.useState)(!1),[p,h]=(0,r.useState)(-1),x=(0,r.useRef)(null),v=(0,r.useRef)(null);(0,r.useEffect)(()=>{if(!l.trim()||!s||!Array.isArray(s)){d([]);return}let e=l.toLowerCase().trim(),a=s.filter(s=>s&&s.nome&&s.nome.toLowerCase().includes(e)||s.area_atuacao&&s.area_atuacao.toLowerCase().includes(e)).slice(0,10);d(a),h(a.length>0?0:-1)},[l,s]),(0,r.useEffect)(()=>{let e=e=>{x.current&&!x.current.contains(e.target)&&v.current&&!v.current.contains(e.target)&&u(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);let j=e=>{if(!e||!e.id||!e.nome){console.error("Comiss\xe3o inv\xe1lida selecionada:",e);return}a(e),n(""),u(!1)};return(0,o.jsxs)("div",{className:"relative",children:[(0,o.jsxs)("div",{className:"relative",children:[(0,o.jsx)("input",{ref:x,type:"text",value:l,onChange:e=>{n(e.target.value),u(!0)},onFocus:()=>l.trim()&&u(!0),onKeyDown:e=>{m&&0!==c.length&&("ArrowDown"===e.key?(e.preventDefault(),h(e=>e<c.length-1?e+1:0)):"ArrowUp"===e.key?(e.preventDefault(),h(e=>e>0?e-1:c.length-1)):"Enter"===e.key&&p>=0?(e.preventDefault(),j(c[p])):"Escape"===e.key&&u(!1))},placeholder:i,className:"form-input pr-10",disabled:t,autoComplete:"off"}),(0,o.jsx)("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-oab-gray-400",children:(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]}),m&&c.length>0&&(0,o.jsx)("ul",{ref:v,className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-auto",children:c.map((e,s)=>(0,o.jsxs)("li",{className:"px-4 py-2 cursor-pointer hover:bg-oab-red hover:text-white ".concat(s===p?"bg-oab-red text-white":""),onClick:()=>j(e),onMouseEnter:()=>h(s),children:[(0,o.jsx)("div",{className:"font-medium truncate",children:e.nome}),e.area_atuacao&&(0,o.jsx)("div",{className:"text-xs truncate ".concat(s===p?"text-white":"text-oab-gray-500"),children:e.area_atuacao})]},e.id))})]})}function c(){let e=(0,t.useRouter)(),[s,a]=(0,r.useState)({nome:"",descricao:"",objetivos:"",resultados_esperados:"",publico_alvo:"",data_inicio:"",data_fim_prevista:"",status:"planejamento",comissoes:[],tags:""}),[c,d]=(0,r.useState)([]),[m,u]=(0,r.useState)([]),[p,h]=(0,r.useState)([]),[x,v]=(0,r.useState)(!1),[j,f]=(0,r.useState)(!0),[b,g]=(0,r.useState)(null);(0,r.useEffect)(()=>{{let e=sessionStorage.getItem("sugestaoProjeto");if(e){try{let s=JSON.parse(e);a(e=>({...e,nome:s.nome||"",descricao:s.descricao||"",objetivos:s.objetivos||"",resultados_esperados:s.resultados_esperados||"",publico_alvo:s.publico_alvo||"",tags:s.tags?s.tags.join(", "):""})),h(s.integracoes||[])}catch(e){console.error("Erro ao ler sugest\xe3o de projeto:",e)}sessionStorage.removeItem("sugestaoProjeto")}}(async()=>{try{f(!0);let{data:e}=await l.h.getComissoes();d(e)}catch(e){console.error("Erro ao carregar comiss\xf5es:",e),g("N\xe3o foi poss\xedvel carregar as comiss\xf5es. Tente novamente mais tarde.")}finally{f(!1)}})()},[]);let N=e=>{let{name:o,value:r}=e.target;a({...s,[o]:r})},y=(e,s)=>{if(!m||!Array.isArray(m)){console.error("Lista de comiss\xf5es selecionadas n\xe3o dispon\xedvel");return}u(m.map(a=>a.comissao_id===e?{...a,papel_comissao:s}:a))},_=e=>{if(!m||!Array.isArray(m)){console.error("Lista de comiss\xf5es selecionadas n\xe3o dispon\xedvel");return}u(m.filter(s=>s.comissao_id!==e))},w=async a=>{if(a.preventDefault(),!s.nome.trim()){alert("O nome do projeto \xe9 obrigat\xf3rio.");return}if(!m||!Array.isArray(m)||0===m.length){alert("Selecione pelo menos uma comiss\xe3o para o projeto.");return}let o=m.filter(e=>e&&e.comissao_id&&"string"==typeof e.comissao_id&&e.papel_comissao);if(0===o.length){alert("Nenhuma comiss\xe3o v\xe1lida selecionada. Adicione pelo menos uma comiss\xe3o.");return}console.log("Comiss\xf5es selecionadas:",m),console.log("Comiss\xf5es v\xe1lidas:",o);let r=s.tags?s.tags.split(",").map(e=>e.trim()).filter(e=>""!==e):[];try{v(!0),g(null);let a={...s,comissoes:o.map(e=>({comissao_id:e.comissao_id,papel_comissao:e.papel_comissao})),tags:r};console.log("Enviando dados do projeto:",a);let t=await l.h.criarProjeto(a);if(console.log("Resposta da API:",t),p&&p.length>0)try{localStorage.setItem("sugestoesIntegracao_".concat(t.data.id),JSON.stringify(p))}catch(e){console.error("Erro ao salvar sugest\xf5es de integra\xe7\xe3o:",e)}alert("Projeto criado com sucesso!"),e.push("/projetos/".concat(t.data.id))}catch(e){console.error("Erro ao criar projeto:",e),g(e.message||"Ocorreu um erro ao criar o projeto. Tente novamente.")}finally{v(!1)}};return(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{className:"mb-6",children:[(0,o.jsxs)(i.default,{href:"/projetos",className:"flex items-center text-oab-red hover:text-oab-burgundy mb-2 inline-block",children:[(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Voltar para Projetos"]}),(0,o.jsx)("h1",{className:"text-3xl font-bold text-oab-gray-800 mb-2",children:"Novo Projeto"}),(0,o.jsx)("p",{className:"text-oab-gray-600 mt-1",children:"Preencha o formul\xe1rio abaixo para criar um novo projeto"})]}),b&&(0,o.jsx)("div",{className:"bg-red-50 border-l-4 border-oab-red text-red-700 p-4 mb-6",role:"alert",children:(0,o.jsx)("p",{children:b})}),(0,o.jsxs)("form",{onSubmit:w,className:"card",children:[(0,o.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,o.jsxs)("div",{className:"col-span-1 md:col-span-2",children:[(0,o.jsx)("label",{htmlFor:"nome",className:"form-label",children:"Nome do Projeto *"}),(0,o.jsx)("input",{type:"text",id:"nome",name:"nome",value:s.nome,onChange:N,className:"form-input",required:!0})]}),(0,o.jsxs)("div",{className:"col-span-1 md:col-span-2",children:[(0,o.jsx)("label",{htmlFor:"descricao",className:"form-label",children:"Descri\xe7\xe3o"}),(0,o.jsx)("textarea",{id:"descricao",name:"descricao",value:s.descricao,onChange:N,rows:"3",className:"form-input"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"objetivos",className:"form-label",children:"Objetivos"}),(0,o.jsx)("textarea",{id:"objetivos",name:"objetivos",value:s.objetivos,onChange:N,rows:"3",className:"form-input"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"resultados_esperados",className:"form-label",children:"Resultados Esperados"}),(0,o.jsx)("textarea",{id:"resultados_esperados",name:"resultados_esperados",value:s.resultados_esperados,onChange:N,rows:"3",className:"form-input"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"publico_alvo",className:"form-label",children:"P\xfablico Alvo"}),(0,o.jsx)("input",{type:"text",id:"publico_alvo",name:"publico_alvo",value:s.publico_alvo,onChange:N,className:"form-input"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"status",className:"form-label",children:"Status *"}),(0,o.jsxs)("select",{id:"status",name:"status",value:s.status,onChange:N,className:"form-input",required:!0,children:[(0,o.jsx)("option",{value:"planejamento",children:"Planejamento"}),(0,o.jsx)("option",{value:"em_andamento",children:"Em Andamento"}),(0,o.jsx)("option",{value:"concluido",children:"Conclu\xeddo"}),(0,o.jsx)("option",{value:"cancelado",children:"Cancelado"})]})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"data_inicio",className:"form-label",children:"Data de In\xedcio"}),(0,o.jsx)("input",{type:"date",id:"data_inicio",name:"data_inicio",value:s.data_inicio,onChange:N,className:"form-input"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"data_fim_prevista",className:"form-label",children:"Data de Conclus\xe3o Prevista"}),(0,o.jsx)("input",{type:"date",id:"data_fim_prevista",name:"data_fim_prevista",value:s.data_fim_prevista,onChange:N,className:"form-input"})]}),(0,o.jsxs)("div",{className:"col-span-1 md:col-span-2",children:[(0,o.jsx)("label",{htmlFor:"tags",className:"form-label",children:"Tags (separadas por v\xedrgula)"}),(0,o.jsx)("input",{type:"text",id:"tags",name:"tags",value:s.tags,onChange:N,placeholder:"Ex: direito digital, educa\xe7\xe3o, evento",className:"form-input"})]})]}),(0,o.jsxs)("div",{className:"mb-6",children:[(0,o.jsx)("h2",{className:"text-xl font-bold text-oab-gray-800 mb-4 border-b border-gray-200 pb-2",children:"Comiss\xf5es Participantes *"}),(0,o.jsx)("div",{className:"flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4",children:(0,o.jsxs)("div",{className:"flex-1",children:[(0,o.jsx)(n,{comissoes:c,onComissaoSelect:e=>{if(!e||!e.id||!e.nome){console.error("Comiss\xe3o selecionada inv\xe1lida:",e);return}if(m&&Array.isArray(m)&&m.some(s=>s.comissao_id===e.id)){alert("Esta comiss\xe3o j\xe1 foi adicionada ao projeto.");return}let s=Array.isArray(m)?[...m]:[];s.push({comissao_id:e.id,nome:e.nome,papel_comissao:"participante"}),u(s)},disabled:j,placeholder:"Digite para buscar uma comiss\xe3o..."}),j&&(0,o.jsx)("p",{className:"text-sm text-oab-gray-500 mt-1",children:"Carregando comiss\xf5es..."})]})}),m.length>0?(0,o.jsx)("div",{className:"mt-4",children:(0,o.jsx)("ul",{className:"border rounded-md divide-y",children:m&&m.map(e=>(0,o.jsxs)("li",{className:"p-4 flex flex-col md:flex-row md:items-center md:justify-between hover:bg-oab-gray-50",children:[(0,o.jsx)("div",{className:"font-medium text-oab-gray-800",children:e.nome}),(0,o.jsxs)("div",{className:"flex items-center space-x-4 mt-2 md:mt-0",children:[(0,o.jsx)("div",{children:(0,o.jsxs)("select",{value:e.papel_comissao,onChange:s=>y(e.comissao_id,s.target.value),className:"px-3 py-1 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-oab-red",children:[(0,o.jsx)("option",{value:"lider",children:"L\xedder"}),(0,o.jsx)("option",{value:"participante",children:"Participante"}),(0,o.jsx)("option",{value:"consultivo",children:"Consultivo"})]})}),(0,o.jsx)("button",{type:"button",onClick:()=>_(e.comissao_id),className:"text-oab-red hover:text-oab-burgundy",children:(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},e.comissao_id))})}):(0,o.jsx)("p",{className:"text-oab-gray-500 mt-4 bg-oab-gray-50 p-4 border rounded-md",children:"Nenhuma comiss\xe3o selecionada"})]}),(0,o.jsxs)("div",{className:"flex justify-end space-x-4 border-t border-gray-200 pt-6 mt-6",children:[(0,o.jsx)(i.default,{href:"/projetos",className:"btn-secondary",children:"Cancelar"}),(0,o.jsx)("button",{type:"submit",disabled:x,className:"btn-primary",children:x?"Salvando...":"Salvar Projeto"})]})]})]})}}},function(e){e.O(0,[648,933,971,117,744],function(){return e(e.s=2790)}),_N_E=e.O()}]);