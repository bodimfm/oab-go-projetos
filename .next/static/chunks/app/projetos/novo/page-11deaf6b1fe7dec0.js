(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[394],{2790:function(e,o,a){Promise.resolve().then(a.bind(a,7371))},9376:function(e,o,a){"use strict";var r=a(5475);a.o(r,"useParams")&&a.d(o,{useParams:function(){return r.useParams}}),a.o(r,"useRouter")&&a.d(o,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(o,{useSearchParams:function(){return r.useSearchParams}})},7371:function(e,o,a){"use strict";a.r(o),a.d(o,{default:function(){return l}});var r=a(7437),s=a(2265),t=a(9376),i=a(7648),n=a(4933);function c(e){let{comissoes:o,onComissaoSelect:a,disabled:t,placeholder:i="Buscar comiss\xe3o..."}=e,[n,c]=(0,s.useState)(""),[l,d]=(0,s.useState)([]),[m,u]=(0,s.useState)(!1),[p,h]=(0,s.useState)(-1),f=(0,s.useRef)(null),b=(0,s.useRef)(null);(0,s.useEffect)(()=>{if(!n.trim()||!o||!Array.isArray(o)){d([]);return}let e=n.toLowerCase().trim(),a=o.filter(o=>o.nome.toLowerCase().includes(e)||o.area_atuacao&&o.area_atuacao.toLowerCase().includes(e)).slice(0,10);d(a),h(a.length>0?0:-1)},[n,o]),(0,s.useEffect)(()=>{let e=e=>{f.current&&!f.current.contains(e.target)&&b.current&&!b.current.contains(e.target)&&u(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);let j=e=>{a(e),c(""),u(!1)};return(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{ref:f,type:"text",value:n,onChange:e=>{c(e.target.value),u(!0)},onFocus:()=>n.trim()&&u(!0),onKeyDown:e=>{m&&0!==l.length&&("ArrowDown"===e.key?(e.preventDefault(),h(e=>e<l.length-1?e+1:0)):"ArrowUp"===e.key?(e.preventDefault(),h(e=>e>0?e-1:l.length-1)):"Enter"===e.key&&p>=0?(e.preventDefault(),j(l[p])):"Escape"===e.key&&u(!1))},placeholder:i,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:t,autoComplete:"off"}),m&&l.length>0&&(0,r.jsx)("ul",{ref:b,className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-auto",children:l.map((e,o)=>(0,r.jsxs)("li",{className:"px-4 py-2 cursor-pointer hover:bg-blue-50 ".concat(o===p?"bg-blue-100":""),onClick:()=>j(e),onMouseEnter:()=>h(o),children:[(0,r.jsx)("div",{className:"font-medium truncate",children:e.nome}),e.area_atuacao&&(0,r.jsx)("div",{className:"text-xs text-gray-500 truncate",children:e.area_atuacao})]},e.id))})]})}function l(){let e=(0,t.useRouter)(),[o,a]=(0,s.useState)({nome:"",descricao:"",objetivos:"",resultados_esperados:"",publico_alvo:"",data_inicio:"",data_fim_prevista:"",status:"planejamento",comissoes:[],tags:""}),[l,d]=(0,s.useState)([]),[m,u]=(0,s.useState)([]),[p,h]=(0,s.useState)(!1),[f,b]=(0,s.useState)(!0),[j,g]=(0,s.useState)(null);(0,s.useEffect)(()=>{(async()=>{try{b(!0);let{data:e}=await n.h.getComissoes();d(e)}catch(e){console.error("Erro ao carregar comiss\xf5es:",e),g("N\xe3o foi poss\xedvel carregar as comiss\xf5es. Tente novamente mais tarde.")}finally{b(!1)}})()},[]);let x=e=>{let{name:r,value:s}=e.target;a({...o,[r]:s})},v=(e,o)=>{if(!m||!Array.isArray(m)){console.error("Lista de comiss\xf5es selecionadas n\xe3o dispon\xedvel");return}u(m.map(a=>a.comissao_id===e?{...a,papel_comissao:o}:a))},y=e=>{if(!m||!Array.isArray(m)){console.error("Lista de comiss\xf5es selecionadas n\xe3o dispon\xedvel");return}u(m.filter(o=>o.comissao_id!==e))},_=async a=>{if(a.preventDefault(),!o.nome.trim()){alert("O nome do projeto \xe9 obrigat\xf3rio.");return}if(0===m.length){alert("Selecione pelo menos uma comiss\xe3o para o projeto.");return}let r=o.tags?o.tags.split(",").map(e=>e.trim()).filter(e=>""!==e):[];try{h(!0),g(null),await n.h.criarProjeto({...o,comissoes:m,tags:r}),alert("Projeto criado com sucesso!"),e.push("/projetos")}catch(e){console.error("Erro ao criar projeto:",e),g(e.message||"Ocorreu um erro ao criar o projeto. Tente novamente.")}finally{h(!1)}};return(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)(i.default,{href:"/projetos",className:"text-blue-600 hover:text-blue-800 mb-2 inline-block",children:"← Voltar para Projetos"}),(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-800",children:"Novo Projeto"}),(0,r.jsx)("p",{className:"text-gray-600 mt-1",children:"Preencha o formul\xe1rio abaixo para criar um novo projeto"})]}),j&&(0,r.jsx)("div",{className:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6",role:"alert",children:(0,r.jsx)("p",{children:j})}),(0,r.jsxs)("form",{onSubmit:_,className:"bg-white p-6 rounded-lg shadow-md",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,r.jsxs)("div",{className:"col-span-1 md:col-span-2",children:[(0,r.jsx)("label",{htmlFor:"nome",className:"block text-gray-700 font-medium mb-2",children:"Nome do Projeto *"}),(0,r.jsx)("input",{type:"text",id:"nome",name:"nome",value:o.nome,onChange:x,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,r.jsxs)("div",{className:"col-span-1 md:col-span-2",children:[(0,r.jsx)("label",{htmlFor:"descricao",className:"block text-gray-700 font-medium mb-2",children:"Descri\xe7\xe3o"}),(0,r.jsx)("textarea",{id:"descricao",name:"descricao",value:o.descricao,onChange:x,rows:"3",className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"objetivos",className:"block text-gray-700 font-medium mb-2",children:"Objetivos"}),(0,r.jsx)("textarea",{id:"objetivos",name:"objetivos",value:o.objetivos,onChange:x,rows:"3",className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"resultados_esperados",className:"block text-gray-700 font-medium mb-2",children:"Resultados Esperados"}),(0,r.jsx)("textarea",{id:"resultados_esperados",name:"resultados_esperados",value:o.resultados_esperados,onChange:x,rows:"3",className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"publico_alvo",className:"block text-gray-700 font-medium mb-2",children:"P\xfablico Alvo"}),(0,r.jsx)("input",{type:"text",id:"publico_alvo",name:"publico_alvo",value:o.publico_alvo,onChange:x,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"status",className:"block text-gray-700 font-medium mb-2",children:"Status *"}),(0,r.jsxs)("select",{id:"status",name:"status",value:o.status,onChange:x,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[(0,r.jsx)("option",{value:"planejamento",children:"Planejamento"}),(0,r.jsx)("option",{value:"em_andamento",children:"Em Andamento"}),(0,r.jsx)("option",{value:"concluido",children:"Conclu\xeddo"}),(0,r.jsx)("option",{value:"cancelado",children:"Cancelado"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"data_inicio",className:"block text-gray-700 font-medium mb-2",children:"Data de In\xedcio"}),(0,r.jsx)("input",{type:"date",id:"data_inicio",name:"data_inicio",value:o.data_inicio,onChange:x,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"data_fim_prevista",className:"block text-gray-700 font-medium mb-2",children:"Data de Conclus\xe3o Prevista"}),(0,r.jsx)("input",{type:"date",id:"data_fim_prevista",name:"data_fim_prevista",value:o.data_fim_prevista,onChange:x,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,r.jsxs)("div",{className:"col-span-1 md:col-span-2",children:[(0,r.jsx)("label",{htmlFor:"tags",className:"block text-gray-700 font-medium mb-2",children:"Tags (separadas por v\xedrgula)"}),(0,r.jsx)("input",{type:"text",id:"tags",name:"tags",value:o.tags,onChange:x,placeholder:"Ex: direito digital, educa\xe7\xe3o, evento",className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:"Comiss\xf5es Participantes *"}),(0,r.jsx)("div",{className:"flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4",children:(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)(c,{comissoes:l,onComissaoSelect:e=>{if(e){if(m.some(o=>o.comissao_id===e.id)){alert("Esta comiss\xe3o j\xe1 foi adicionada ao projeto.");return}u([...m,{comissao_id:e.id,nome:e.nome,papel_comissao:"participante"}])}},disabled:f,placeholder:"Digite para buscar uma comiss\xe3o..."}),f&&(0,r.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Carregando comiss\xf5es..."})]})}),m.length>0?(0,r.jsx)("div",{className:"mt-4",children:(0,r.jsx)("ul",{className:"border rounded-md divide-y",children:m&&m.map(e=>(0,r.jsxs)("li",{className:"p-4 flex flex-col md:flex-row md:items-center md:justify-between",children:[(0,r.jsx)("div",{className:"font-medium",children:e.nome}),(0,r.jsxs)("div",{className:"flex items-center space-x-4 mt-2 md:mt-0",children:[(0,r.jsx)("div",{children:(0,r.jsxs)("select",{value:e.papel_comissao,onChange:o=>v(e.comissao_id,o.target.value),className:"px-3 py-1 border border-gray-300 rounded-md text-sm",children:[(0,r.jsx)("option",{value:"lider",children:"L\xedder"}),(0,r.jsx)("option",{value:"participante",children:"Participante"}),(0,r.jsx)("option",{value:"consultivo",children:"Consultivo"})]})}),(0,r.jsx)("button",{type:"button",onClick:()=>y(e.comissao_id),className:"text-red-600 hover:text-red-800",children:"Remover"})]})]},e.comissao_id))})}):(0,r.jsx)("p",{className:"text-gray-500 mt-4",children:"Nenhuma comiss\xe3o selecionada"})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,r.jsx)(i.default,{href:"/projetos",className:"px-6 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-100 transition-colors",children:"Cancelar"}),(0,r.jsx)("button",{type:"submit",disabled:p,className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md transition-colors disabled:bg-blue-400",children:p?"Salvando...":"Salvar Projeto"})]})]})]})}},4933:function(e,o,a){"use strict";a.d(o,{h:function(){return i}});let r="".concat("https://qnsbjljmnflihwcovuwz.supabase.co","/rest/v1"),s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFuc2JqbGptbmZsaWh3Y292dXd6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY5NjcyNjQsImV4cCI6MjA2MjU0MzI2NH0.UWGXOyL8J7e11W_CE3zIo5bn-5LwKQ1YtAS1V72DTtk",t={Authorization:"Bearer ".concat(s),apikey:s,"Content-Type":"application/json"},i={getComissoes:async()=>{let e=await fetch("".concat(r,"/comissoes?select=*&order=nome"),{headers:t});if(!e.ok)throw Error("Erro ao carregar comiss\xf5es");return{data:await e.json()}},getProjetos:async()=>{let e=await fetch("".concat(r,"/view_projetos_comissoes?select=*"),{headers:t});if(!e.ok)throw Error("Erro ao carregar projetos");let o=await e.json(),a={};return o.forEach(e=>{a[e.projeto_id]||(a[e.projeto_id]={id:e.projeto_id,nome:e.projeto_nome,descricao:e.projeto_descricao,status:e.projeto_status,objetivos:e.objetivos,publico_alvo:e.publico_alvo,data_inicio:e.data_inicio,data_fim_prevista:e.data_fim_prevista,comissoes:[]}),a[e.projeto_id].comissoes.push({id:e.comissao_id,nome:e.comissao_nome,descricao:e.comissao_descricao,papel:e.papel_comissao})}),{data:Object.values(a)}},getProjeto:async e=>{let o=await fetch("".concat(r,"/projetos?id=eq.").concat(e,"&select=*"),{headers:t});if(!o.ok)throw Error("Erro ao carregar detalhes do projeto");let a=await o.json();if(0===a.length)throw Error("Projeto n\xe3o encontrado");let s=await fetch("".concat(r,"/projetos_comissoes?projeto_id=eq.").concat(e,"&select=papel_comissao,comissoes:comissoes(id,nome,descricao,area_atuacao)"),{headers:t});if(!s.ok)throw Error("Erro ao carregar comiss\xf5es do projeto");let i=await s.json(),n=await fetch("".concat(r,"/tags_projetos?projeto_id=eq.").concat(e,"&select=tag"),{headers:t});if(!n.ok)throw Error("Erro ao carregar tags do projeto");let c=await n.json();return{data:{...a[0],comissoes:i.map(e=>({papel:e.papel_comissao,...e.comissoes})),tags:c.map(e=>e.tag)}}},getSugestoesIntegracao:async e=>{let o=await fetch("".concat(r,"/rpc/sugerir_integracao_projetos"),{method:"POST",headers:t,body:JSON.stringify({projeto_id:e})});if(!o.ok)throw Error("Erro ao carregar sugest\xf5es de integra\xe7\xe3o");return{data:await o.json()}},getMembros:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,o="".concat(r,"/view_membros_comissoes?select=*");e&&(o+="&comissao_id=eq.".concat(e)),o+="&order=comissao_nome,membro_nome";let a=await fetch(o,{headers:t});if(!a.ok)throw Error("Erro ao carregar membros");return{data:await a.json()}},buscar:async e=>{let o=await fetch("".concat(r,"/rpc/buscar_projetos_e_comissoes"),{method:"POST",headers:t,body:JSON.stringify({termo:e})});if(!o.ok)throw Error("Erro ao realizar busca");return{data:await o.json()}},criarProjeto:async e=>{let{nome:o,descricao:a,objetivos:s,resultados_esperados:i,publico_alvo:n,data_inicio:c,data_fim_prevista:l,status:d,comissoes:m,tags:u}=e;if(!o||!d||!m||0===m.length)throw Error("Campos obrigat\xf3rios: nome, status e pelo menos uma comiss\xe3o");let p=await fetch("".concat(r,"/projetos"),{method:"POST",headers:{...t,Prefer:"return=representation"},body:JSON.stringify({nome:o,descricao:a,objetivos:s,resultados_esperados:i,publico_alvo:n,data_inicio:c,data_fim_prevista:l,status:d})});if(!p.ok)throw Error((await p.json()).message||"Erro ao criar projeto");let h=await p.json(),f=h[0].id,b=m.map(e=>({projeto_id:f,comissao_id:e.comissao_id,papel_comissao:e.papel_comissao}));if(!(await fetch("".concat(r,"/projetos_comissoes"),{method:"POST",headers:t,body:JSON.stringify(b)})).ok)throw Error("Erro ao relacionar projeto com comiss\xf5es");if(u&&u.length>0){let e=u.map(e=>({projeto_id:f,tag:e}));if(!(await fetch("".concat(r,"/tags_projetos"),{method:"POST",headers:t,body:JSON.stringify(e)})).ok)throw Error("Erro ao adicionar tags ao projeto")}return{data:h[0]}},adicionarMembro:async e=>{let{comissao_id:o,nome:a,cargo:s,email:i,telefone:n,inscricao_oab:c}=e;if(!o||!a)throw Error("Campos obrigat\xf3rios: comissao_id e nome");let l=await fetch("".concat(r,"/membros_comissoes"),{method:"POST",headers:{...t,Prefer:"return=representation"},body:JSON.stringify({comissao_id:o,nome:a,cargo:s,email:i,telefone:n,inscricao_oab:c})});if(!l.ok)throw Error((await l.json()).message||"Erro ao adicionar membro");return{data:(await l.json())[0]}}}}},function(e){e.O(0,[648,971,117,744],function(){return e(e.s=2790)}),_N_E=e.O()}]);