"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[933],{4933:function(o,e,r){r.d(e,{h:function(){return i}});let a="".concat("https://qnsbjljmnflihwcovuwz.supabase.co","/rest/v1"),t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFuc2JqbGptbmZsaWh3Y292dXd6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY5NjcyNjQsImV4cCI6MjA2MjU0MzI2NH0.UWGXOyL8J7e11W_CE3zIo5bn-5LwKQ1YtAS1V72DTtk",s={Authorization:"Bearer ".concat(t),apikey:t,"Content-Type":"application/json"},i={getComissoes:async()=>{let o=await fetch("".concat(a,"/comissoes?select=*&order=nome"),{headers:s});if(!o.ok)throw Error("Erro ao carregar comiss\xf5es");return{data:await o.json()}},getProjetos:async()=>{let o=await fetch("".concat(a,"/view_projetos_comissoes?select=*"),{headers:s});if(!o.ok)throw Error("Erro ao carregar projetos");let e=await o.json(),r={};return e.forEach(o=>{r[o.projeto_id]||(r[o.projeto_id]={id:o.projeto_id,nome:o.projeto_nome,descricao:o.projeto_descricao,status:o.projeto_status,objetivos:o.objetivos,publico_alvo:o.publico_alvo,data_inicio:o.data_inicio,data_fim_prevista:o.data_fim_prevista,comissoes:[]}),o.comissao_id&&r[o.projeto_id].comissoes.push({id:o.comissao_id,nome:o.comissao_nome,descricao:o.comissao_descricao,papel:o.papel_comissao})}),{data:Object.values(r)}},getProjeto:async o=>{let e=await fetch("".concat(a,"/projetos?id=eq.").concat(o,"&select=*"),{headers:s});if(!e.ok)throw Error("Erro ao carregar detalhes do projeto");let r=await e.json();if(0===r.length)throw Error("Projeto n\xe3o encontrado");let t=await fetch("".concat(a,"/projetos_comissoes?projeto_id=eq.").concat(o,"&select=papel_comissao,comissoes:comissoes(id,nome,descricao,area_atuacao)"),{headers:s});if(!t.ok)throw Error("Erro ao carregar comiss\xf5es do projeto");let i=await t.json(),c=await fetch("".concat(a,"/tags_projetos?projeto_id=eq.").concat(o,"&select=tag"),{headers:s});if(!c.ok)throw Error("Erro ao carregar tags do projeto");let n=await c.json();return{data:{...r[0],comissoes:i.map(o=>({papel:o.papel_comissao,...o.comissoes})),tags:n.map(o=>o.tag)}}},getSugestoesIntegracao:async o=>{let e=await fetch("".concat(a,"/rpc/sugerir_integracao_projetos"),{method:"POST",headers:s,body:JSON.stringify({projeto_id:o})});if(!e.ok)throw Error("Erro ao carregar sugest\xf5es de integra\xe7\xe3o");return{data:await e.json()}},getMembros:async function(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e="".concat(a,"/view_membros_comissoes?select=*");o&&(e+="&comissao_id=eq.".concat(o)),e+="&order=comissao_nome,membro_nome";let r=await fetch(e,{headers:s});if(!r.ok)throw Error("Erro ao carregar membros");return{data:await r.json()}},buscar:async o=>{let e=await fetch("".concat(a,"/rpc/buscar_projetos_e_comissoes"),{method:"POST",headers:s,body:JSON.stringify({termo:o})});if(!e.ok)throw Error("Erro ao realizar busca");return{data:await e.json()}},criarProjeto:async o=>{let{nome:e,descricao:r,objetivos:t,resultados_esperados:i,publico_alvo:c,data_inicio:n,data_fim_prevista:d,status:m,comissoes:l,tags:h}=o;if(console.log("Dados para criar projeto:",{nome:e,status:m,comissoes:l?JSON.stringify(l):"undefined",comissoesCount:l?l.length:0}),!e||!m||!l||0===l.length)throw Error("Campos obrigat\xf3rios: nome, status e pelo menos uma comiss\xe3o");let p=await fetch("".concat(a,"/projetos"),{method:"POST",headers:{...s,Prefer:"return=representation"},body:JSON.stringify({nome:e,descricao:r,objetivos:t,resultados_esperados:i,publico_alvo:c,data_inicio:n,data_fim_prevista:d,status:m})});if(!p.ok)throw Error((await p.json()).message||"Erro ao criar projeto");let u=await p.json(),f=u[0].id;console.log("Projeto criado com ID:",f);let w=l.map(o=>({projeto_id:f,comissao_id:o.comissao_id,papel_comissao:o.papel_comissao||"participante"}));console.log("Comiss\xf5es para vincular:",JSON.stringify(w));let _=0;for(let o of w)try{if(!o.comissao_id||"string"!=typeof o.comissao_id||!o.comissao_id.match(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i)){console.error("ID de comiss\xe3o inv\xe1lido: ".concat(o.comissao_id));continue}console.log("Tentando vincular comiss\xe3o: ".concat(o.comissao_id));let e=await fetch("".concat(a,"/projetos_comissoes"),{method:"POST",headers:{...s,Prefer:"return=representation"},body:JSON.stringify({projeto_id:f,comissao_id:o.comissao_id,papel_comissao:o.papel_comissao||"participante"})});if(!e.ok){let r=await e.text();console.error("Erro ao vincular comiss\xe3o (".concat(o.comissao_id,"): "),r);try{let o=JSON.parse(r);console.error("Detalhes do erro:",o)}catch(o){}continue}let r=await e.json();console.log("Comiss\xe3o vinculada com sucesso: ".concat(o.comissao_id),r),_++}catch(e){console.error("Erro ao processar comiss\xe3o (".concat(o.comissao_id,"): "),e);continue}if(console.log("Processo conclu\xeddo: ".concat(_," de ").concat(w.length," comiss\xf5es vinculadas")),h&&h.length>0)for(let o of h)try{if(!o||"string"!=typeof o){console.error("Tag inv\xe1lida: ".concat(o));continue}let e=await fetch("".concat(a,"/tags_projetos"),{method:"POST",headers:{...s,Prefer:"return=representation"},body:JSON.stringify({projeto_id:f,tag:o})});if(!e.ok){let r=await e.text();console.error("Erro ao adicionar tag (".concat(o,"): "),r);continue}}catch(e){console.error("Erro ao processar tag (".concat(o,"): "),e);continue}return 0===_&&w.length>0&&console.warn("Aten\xe7\xe3o: Projeto ".concat(f," criado sem nenhuma comiss\xe3o vinculada")),{data:u[0]}},adicionarMembro:async o=>{let{comissao_id:e,nome:r,cargo:t,email:i,telefone:c,inscricao_oab:n}=o;if(!e||!r)throw Error("Campos obrigat\xf3rios: comissao_id e nome");let d=await fetch("".concat(a,"/membros_comissoes"),{method:"POST",headers:{...s,Prefer:"return=representation"},body:JSON.stringify({comissao_id:e,nome:r,cargo:t,email:i,telefone:c,inscricao_oab:n})});if(!d.ok)throw Error((await d.json()).message||"Erro ao adicionar membro");return{data:(await d.json())[0]}},auth:{login:async(o,e)=>{let r=await fetch("".concat(a,"/usuarios?nome_usuario=eq.").concat(encodeURIComponent(o)),{headers:s});if(!r.ok)throw Error("Erro ao verificar credenciais");let t=await r.json();if(0===t.length)throw Error("Usu\xe1rio n\xe3o encontrado");let i=t[0];if(i.primeiro_acesso&&"OABGONEXT"===e)return{data:{...i,require_password_change:!0}};if(!i.primeiro_acesso){if(i.senha!==e)throw Error("Senha incorreta");return{data:i}}throw Error("Credenciais inv\xe1lidas")},alterarSenha:async(o,e)=>{let r=await fetch("".concat(a,"/usuarios?id=eq.").concat(o),{method:"PATCH",headers:{...s,Prefer:"return=representation"},body:JSON.stringify({senha:e,primeiro_acesso:!1,updated_at:new Date().toISOString()})});if(!r.ok)throw Error("Erro ao alterar senha");return{data:(await r.json())[0]}},solicitarRecuperacao:async o=>{let e=await fetch("".concat(a,"/usuarios?email=eq.").concat(encodeURIComponent(o)),{headers:s});if(!e.ok)throw Error("Erro ao verificar email");let r=await e.json();if(0===r.length)throw Error("Email n\xe3o encontrado");let t=Math.random().toString(36).substring(2,15),i=new Date;if(i.setHours(i.getHours()+24),!(await fetch("".concat(a,"/usuarios?id=eq.").concat(r[0].id),{method:"PATCH",headers:{...s,Prefer:"return=representation"},body:JSON.stringify({token_recuperacao:t,token_expira:i.toISOString(),primeiro_acesso:!0})})).ok)throw Error("Erro ao gerar token de recupera\xe7\xe3o");return{data:{token:t,message:"Um link de recupera\xe7\xe3o foi enviado para seu email"}}},verificarToken:async o=>{let e=await fetch("".concat(a,"/usuarios?token_recuperacao=eq.").concat(o),{headers:s});if(!e.ok)throw Error("Erro ao verificar token");let r=await e.json();if(0===r.length)throw Error("Token inv\xe1lido");let t=r[0];if(new Date(t.token_expira)<new Date)throw Error("Token expirado");return{data:t}},cadastrarUsuario:async o=>{let e=await fetch("".concat(a,"/usuarios?comissao_id=eq.").concat(o.comissao_id),{headers:s});if(!e.ok)throw Error("Erro ao verificar comiss\xe3o");if((await e.json()).length>0)throw Error("Esta comiss\xe3o j\xe1 possui um usu\xe1rio vinculado");let r=await fetch("".concat(a,"/comissoes?id=eq.").concat(o.comissao_id,"&select=nome"),{headers:s});if(!r.ok)throw Error("Erro ao obter dados da comiss\xe3o");let t=await r.json();if(0===t.length)throw Error("Comiss\xe3o n\xe3o encontrada");let i=t[0].nome.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\w\s]/gi,"").replace(/\s+/g,"").toLowerCase(),c=await fetch("".concat(a,"/usuarios"),{method:"POST",headers:{...s,Prefer:"return=representation"},body:JSON.stringify({nome_usuario:i,nome_completo:o.nome_completo,email:o.email,comissao_id:o.comissao_id,senha:"OABGONEXT",primeiro_acesso:!0,created_at:new Date().toISOString()})});if(!c.ok)throw Error("Erro ao cadastrar usu\xe1rio");return{data:(await c.json())[0],message:"Usu\xe1rio criado com sucesso! Nome de usu\xe1rio: ".concat(i)}}}}}}]);